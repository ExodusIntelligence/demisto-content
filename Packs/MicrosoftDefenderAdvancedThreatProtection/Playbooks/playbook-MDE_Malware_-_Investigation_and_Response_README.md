This playbook investigates Microsoft Defender For Endpoint malware alerts. In this playbook, we are using:
- Microsoft Defender For Endpoint Advanced Hunting
- Command Line Analysis
- Dedup
- Sandbox hash search and detonation
- Pro-Active investigation actions: Av scan, Investigation Package collection, Run Automated Investigation on an endpoint
- Microsoft Defender For Endpoint alert enrichment
- Incident Handling ( True/False Positive)

## Dependencies
This playbook uses the following sub-playbooks, integrations, and scripts.

### Sub-playbooks
* 470ceb33-1487-47a0-8337-a6c50149f385
* 30dc7ee1-0b30-4643-8955-f35cf0a8fe65
* 5d24f937-9988-4647-8247-7415e343b581
* 28a9069d-1412-4262-8823-69010271a021
* Command-Line Analysis
* 87353eea-72a8-43b9-8e91-d9ba986ef5da
* ae9483be-d4d5-4c55-89fd-d6dd3fe60e5b
* Dedup - Generic v4
* 00d681fc-f2e1-4144-8bda-f9bff976cbfb
* a62b206f-01f5-4e17-8594-e190523e5723

### Integrations
This playbook does not use any integrations.

### Scripts
* ZipStrings
* MalwareFindingsParse

### Commands
* setIncident

## Playbook Inputs
---

| **Name** | **Description** | **Default Value** | **Required** |
| --- | --- | --- | --- |
| TicketingSystemToUse | Possible Options: SNOW / Jira <br/>\*SNOW == ServiceNow |  | Optional |
| RetrieveFile | Indicates if file retrieval from the endpoint is allowed.<br/>True/False | True | Optional |
| DetonateFile | Indicates if file detonation is allowed on the sandbox.<br/>True/False | True | Optional |
| EnableDeduplication | "Indicates if the deduplication playbook will be used.<br/>    True/False" | True | Optional |
| BenignTagName | The name of the tag to apply for allowed indicators. | BenignTagName | Optional |
| RunInvestigationActivities | Choose if you would like to run automatically Investigation Activities. \(This relies on \`ActionTask\` input \).<br/>Possible values: True/False | True | Optional |
| AdvancedHunting | Choose if you want to run Advance Hunting queries through your Microsoft Defender For Endpoint Instance. Note that it may take some time. | True | Optional |
| DeduphandleSimilar | This input defines how to handle Similar incidents. <br/>You may choose between: "Link", "Close", "Link and Close".<br/>Note: that closing incidents will require you to define "CloseSimilar" input as well.<br/>Also, note that the closer will apply on at least one of the options \(indicators or fields\) which will match the "closer percentage" criteria.<br/>Default: Link  | Link and Close | Optional |
| DedupCloseSimilar | Define if you would like to close incidents by a similarity percentage. The percentage will be the bottom border for closing inc.<br/>This option will close also exact matches as well \( if there are\).<br/>Value should be between 0 to 1 \[0=low similarity , 1=identical\] | 0.9 | Optional |
| EnableClosureSteps | Indicates if the use of closure steps is allowed or incident will close automatically.<br/>    True/False | True | Optional |
| TicketProjectName | In case you are using Jira, please specify the Jira Project Key here \( can be retrieved from the Jira console\) |  | Optional |
| AutoCollectinvestigationPackege | Choose if you would like to autorun action to collect Investigation Package from an Endpoint.<br/>Possible values: True/False | False | Optional |
| ActionTask | Option for input \( can be entered as comma-separated values\):<br/>\`Full Scan\` - Fully Scan the provided endpoint/s<br/>\`Collect Investigation Package\` - Collect investigation package from endpoint/s \(only for supported devices\)<br/>\`Automated Investigation\` - Run Automated Investigation on the provided endpoint<br/>In case it will remain empty, the actions should be checked manually. |  | Optional |
| AutoAVScan | Choose if you would like to autorun a Full AV Scan on your Endpoint.<br/>Possible values: True/False | False | Optional |
| AutoAutomatedInvestigation | Choose if you would like to autorun Automated Investigation on your Endpoint.<br/>Possible values: True/False | False | Optional |
| MaliciousTagName | The tag to assign for indicators to block. | MaliciousTagName | Optional |
| AutoUnisolation | Indicates if automatic un-isolation is allowed<br/>    True/False | False | Optional |
| DidAlertOriginateFromSIEM | In case the alert originated from SIEM no need to run the Incident enrichment flow. | False | Optional |
| DedupSimilarTextField | Comma-separated list of incident text fields to take into account when computing similarity. For example commandline, URL | agnetsid,users,agentsid,CMDline,Hostnames,filenames,filepaths | Optional |
| AutoIsolation | Indicates if endpoint isolation is allowed.<br/>True/False | False | Optional |
| DedupMinimunIncidentSimilarity | Retain incidents with a similarity score that's higher than the MinimunIncidentSimilarity.<br/>Default: 0.2<br/>Value should be between 0 to 1 \[0=low similarity, 1=identical\] | 0.2 | Optional |
| DedupLimit | The maximum number of incidents to query and set to context data.<br/>Default is: 200 | 200 | Optional |

## Playbook Outputs
---
There are no outputs for this playbook.

## Playbook Image
---
![MDE Malware - Investigation and Response](../doc_files/MDE_Malware_-_Investigation_and_Response.png)