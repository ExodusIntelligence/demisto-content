contentitemexportablefields:
  contentitemfields:
    propagationLabels:
    - all
description: |
  This playbook support 3 different actions for the analyst:
  - Run Full AV scan for spesific enpoint
  - Request Investigation Package (zip file that contains forensic data - with a size of ~ 15MB) from an endpoint.
  - Request to run Automatic Investigation on an endpoint.
id: MDE - Pro-Active Actions
inputs:
- description: |-
    Option for input ( can be entered as comma-separated values):
    `Full Scan` - Fully Scan the provided endpoint/s
    `Collect Investigation Package` - Collect investigation package from endpoint/s (only for supported devices)
    `Automated Investigation` - Run Automated Investigation on the provided endpoint
  key: Task
  playbookInputQuery:
  required: false
  value: {}
- description: Provide a list of endpoints for the Scan and Collection of investigation Package to be run on.
  key: Endpoints ID
  playbookInputQuery:
  required: false
  value: {}
- description: True/Fasle
  key: AutoCollectinvestigationPackege
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: True/Fasle
  key: AutoAVScan
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: True/Fasle
  key: AutoAutomatedInvestigation
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
name: MDE - Pro-Active Actions
outputs: []
starttaskid: '0'
tasks:
  '0':
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '15'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 641855f1-2102-4197-86db-cfd629424fc5
      iscommand: false
      name: ''
      version: -1
      description: ''
    taskid: 641855f1-2102-4197-86db-cfd629424fc5
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 170,
          "y": -550
        }
      }
  '1':
    id: '1'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '2'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 5bae2e08-bc22-4dd0-8ef9-d989c1fb044c
      iscommand: false
      name: AV Scan
      type: title
      version: -1
      description: ''
    taskid: 5bae2e08-bc22-4dd0-8ef9-d989c1fb044c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 170,
          "y": 195
        }
      }
  '2':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.AutoAVScan
          operator: isEqualString
          right:
            value:
              simple: 'True'
      label: yes
    id: '2'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '4'
      yes:
      - '3'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: b6c5cea1-1aa7-4f16-8630-ab3c6a80f5e3
      iscommand: false
      name: Auto full AV Scan process?
      type: condition
      description: Check if autorun AV-Scan is requested
      version: -1
    taskid: b6c5cea1-1aa7-4f16-8630-ab3c6a80f5e3
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 170,
          "y": 320
        }
      }
  '3':
    id: '3'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '5'
    note: false
    quietmode: 0
    scriptarguments:
      comment:
        simple: XSAOR - Playbook MSDE Enhanced Actions ${incident.id}
      machine_id:
        simple: ${inputs.Endpoints ID}
      scan_type:
        simple: Full
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Initiate a Microsoft Defender Antivirus scan on a machine.
      id: d774cd98-67f1-4ba9-8ad0-cd7b65cae454
      iscommand: true
      name: Full Av Scan
      script: '|||microsoft-atp-run-antivirus-scan'
      type: regular
      version: -1
    taskid: d774cd98-67f1-4ba9-8ad0-cd7b65cae454
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 170,
          "y": 675
        }
      }
  '4':
    id: '4'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
        simple: Approve AV Scan
      cc:
      format: ''
      methods: []
      replyOptions:
      - Yes
      - No
      subject:
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: false
        retriescount: 2
        retriesinterval: 360
      to:
    nexttasks:
      No:
      - '5'
      Yes:
      - '3'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: e6f4f5fa-e3cb-439f-8478-02c76c24273f
      iscommand: false
      name: Approve AV Scan
      type: condition
      description: Ask for manual approval on AV-Scan
      version: -1
    taskid: e6f4f5fa-e3cb-439f-8478-02c76c24273f
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -50,
          "y": 490
        }
      }
  '5':
    id: '5'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '13'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 9813c91c-f4bb-49d1-8c93-e39affdbc77f
      iscommand: false
      name: AV Scan done
      type: title
      version: -1
      description: ''
    taskid: 9813c91c-f4bb-49d1-8c93-e39affdbc77f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 170,
          "y": 840
        }
      }
  '6':
    id: '6'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '7'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: a9e675ba-2f18-434a-8097-6576d611ff2d
      iscommand: false
      name: Collect investigation package
      type: title
      version: -1
      description: ''
    taskid: a9e675ba-2f18-434a-8097-6576d611ff2d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 630,
          "y": 195
        }
      }
  '7':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.AutoCollectinvestigationPackege
          operator: isEqualString
          right:
            value:
              simple: 'True'
      label: yes
    id: '7'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '9'
      yes:
      - '18'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 1b1f18da-f29a-4752-8fe0-b41ff0e180b8
      iscommand: false
      name: Auto collect investigation package from the Endpoint?
      type: condition
      description: Check if auto-collect investigation package from endpoint is requested
      version: -1
    taskid: 1b1f18da-f29a-4752-8fe0-b41ff0e180b8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 630,
          "y": 320
        }
      }
  '9':
    id: '9'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
        simple: Approve Investigation package collection
      cc:
      format: ''
      methods: []
      replyOptions:
      - Yes
      - No
      subject:
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: false
        retriescount: 2
        retriesinterval: 360
      to:
    nexttasks:
      No:
      - '10'
      Yes:
      - '18'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 47e0164b-4b8e-4171-895a-5ab49f628db7
      iscommand: false
      name: Approve Investigation package collection
      description: Manual approve Investigation Package collection.
      type: condition
      version: -1
    taskid: 47e0164b-4b8e-4171-895a-5ab49f628db7
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 410,
          "y": 490
        }
      }
  '10':
    id: '10'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '13'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 0e5ab7c2-48b6-4620-817b-ee8d576122e4
      iscommand: false
      name: Investigation Package Collection Done
      type: title
      version: -1
      description: ''
    taskid: 0e5ab7c2-48b6-4620-817b-ee8d576122e4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 630,
          "y": 840
        }
      }
  '13':
    id: '13'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: c8e6bcd9-6058-44ce-8bef-8146826a361a
      iscommand: false
      name: Done
      type: title
      version: -1
      description: ''
    taskid: c8e6bcd9-6058-44ce-8bef-8146826a361a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 170,
          "y": 990
        }
      }
  '14':
    form:
      description: ''
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '0'
        label: ''
        labelarg:
          simple: 'What type of actions would you like to '
        options: []
        optionsarg:
        - simple: Full Scan
        - simple: Collect Investigation Package
        - simple: Automated Investigation
        placeholder: ''
        readonly: false
        required: false
        tooltip: ''
        type: multiSelect
      sender: ''
      title: What Type of actions would you like to preform
      totalanswers: 0
    id: '14'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
      cc:
      format: ''
      methods: []
      subject:
        simple: asdasdasd
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to:
        simple: Administrator,Read-Only,Analyst
    nexttasks:
      '#none#':
      - '17'
      - '26'
      - '27'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: df719033-bd04-4e4b-89f6-76c344c9501f
      iscommand: false
      name: Define Additional Actions
      description: Manual define the path that you would like to go through
      type: collection
      version: -1
    taskid: df719033-bd04-4e4b-89f6-76c344c9501f
    timertriggers: []
    type: collection
    view: |-
      {
        "position": {
          "x": 630,
          "y": -220
        }
      }
  '15':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.Task
          operator: isNotEmpty
      label: Input
    id: '15'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '14'
      Input:
      - '27'
      - '26'
      - '17'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: fff1aca9-3fa5-42e9-837d-d1829ddccfad
      iscommand: false
      name: Check Auto Tasks
      description: Check if there are any pre-defined actions for this playbook
      type: condition
      version: -1
    taskid: fff1aca9-3fa5-42e9-837d-d1829ddccfad
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 170,
          "y": -420
        }
      }
  '17':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: What Type of actions would you like to preform.Answers.0
          operator: containsGeneral
          right:
            value:
              simple: Automated Investigation
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.Task
          operator: containsString
          right:
            value:
              simple: Automated Investigation
      label: Automated Investigation
    id: '17'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '28'
      Automated Investigation:
      - '20'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 261af7d9-9aa1-41c5-8bdc-b49aed8a94a8
      iscommand: false
      name: Check Auto Tasks
      description: Check if the automated-investigation is selected
      type: condition
      version: -1
    taskid: 261af7d9-9aa1-41c5-8bdc-b49aed8a94a8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -280,
          "y": 0
        }
      }
  '18':
    id: '18'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '10'
    note: false
    quietmode: 0
    scriptarguments:
      AutoCollectinvestigationPackege:
        simple: 'True'
      MachineIDs:
        simple: ${inputs.Endpoints ID}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: "This playbook aims to simplify the collection of investigation package retrieval into XSOAR from only supported machines (according to the article -  https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/collect-investigation-package?view=o365-worldwide). \n\nThe playbook receives information regarding the target devices (by hostnames, IPs, device ids), validates that those devices exist, and retrieves the collection package from those machines into the XSOAR console. Note that this action may time and the average size of such a package is around ~15 MB."
      id: 97e4ec58-ea1c-4455-8e0d-61a88f894fa4
      iscommand: false
      name: 8d6603be-227b-48fb-8f77-0b0ff3d572db
      playbookId: 8d6603be-227b-48fb-8f77-0b0ff3d572db
      type: playbook
      version: -1
    taskid: 97e4ec58-ea1c-4455-8e0d-61a88f894fa4
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 630,
          "y": 675
        }
      }
  '20':
    id: '20'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '24'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 12024a80-2d99-458c-8851-a3df9917cbbd
      iscommand: false
      name: Automated Investigation
      type: title
      version: -1
      description: ''
    taskid: 12024a80-2d99-458c-8851-a3df9917cbbd
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -280,
          "y": 195
        }
      }
  '22':
    id: '22'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
        simple: Approve Automated Investigation
      cc:
      format: ''
      methods: []
      replyOptions:
      - Yes
      - No
      subject:
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: false
        retriescount: 2
        retriesinterval: 360
      to:
    nexttasks:
      No:
      - '23'
      Yes:
      - '25'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 8aa96727-5391-4daa-8056-f4ecced156a4
      iscommand: false
      name: Approve Automated Investigation
      description: Manual approve automated invesitgation task request
      type: condition
      version: -1
    taskid: 8aa96727-5391-4daa-8056-f4ecced156a4
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -500,
          "y": 490
        }
      }
  '23':
    id: '23'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '13'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 1b2239a1-55f9-439d-8125-779117cb9bfe
      iscommand: false
      name: AV Scan done
      type: title
      version: -1
      description: ''
    taskid: 1b2239a1-55f9-439d-8125-779117cb9bfe
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -280,
          "y": 840
        }
      }
  '24':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.AutoAutomatedInvestigation
          operator: isEqualString
          right:
            value:
              simple: 'True'
      label: yes
    id: '24'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '22'
      yes:
      - '25'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: f409110d-e845-41f3-80a1-e5d7be84e100
      iscommand: false
      name: Auto-run automated investigation?
      description: Check if the auto-run automated investigation request is enabled
      type: condition
      version: -1
    taskid: f409110d-e845-41f3-80a1-e5d7be84e100
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -280,
          "y": 320
        }
      }
  '25':
    id: '25'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '23'
    note: false
    quietmode: 0
    scriptarguments:
      comment:
        simple: 'XSOAR MSDE Investigation playbook - Incident # ${incident.id}'
      machine_id:
        simple: ${Endpoint.ID}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Starts an automated investigation on a machine.
      id: a3df0212-aab3-4e19-8620-d2e3bb24b900
      iscommand: true
      name: Start Automated Investigation On Endpoint
      script: '|||microsoft-atp-start-investigation'
      type: regular
      version: -1
    taskid: a3df0212-aab3-4e19-8620-d2e3bb24b900
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -280,
          "y": 675
        }
      }
  '26':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: What Type of actions would you like to preform.Answers.0
          operator: containsGeneral
          right:
            value:
              simple: Full Scan
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.Task
          operator: containsString
          right:
            value:
              simple: Full Scan
      label: Scan
    id: '26'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '28'
      Scan:
      - '1'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: a969bf39-f8b4-4834-8d5a-d745b1846972
      iscommand: false
      name: Check Auto Tasks
      description: Check if AV-scan requested by the input
      type: condition
      version: -1
    taskid: a969bf39-f8b4-4834-8d5a-d745b1846972
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 170,
          "y": 0
        }
      }
  '27':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: What Type of actions would you like to preform.Answers.0
          operator: containsGeneral
          right:
            value:
              simple: Collect Investigation Package
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.Task
          operator: containsString
          right:
            value:
              simple: Collect Investigation Package
      label: package
    id: '27'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '28'
      package:
      - '6'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: ab94b92a-08c7-45cf-85f7-e4a990e188bc
      iscommand: false
      name: Check Auto Tasks
      type: condition
      description: Check if Collect Investigation Package is requeted by input.
      version: -1
    taskid: ab94b92a-08c7-45cf-85f7-e4a990e188bc
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 630,
          "y": 0
        }
      }
  '28':
    id: '28'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '13'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: db5610d6-43a5-4879-8a91-dd064828ffd2
      iscommand: false
      name: Done
      type: title
      version: -1
      description: ''
    taskid: db5610d6-43a5-4879-8a91-dd064828ffd2
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1080,
          "y": 840
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "15_14_#default#": 0.89
    },
    "paper": {
      "dimensions": {
        "height": 1605,
        "width": 1960,
        "x": -500,
        "y": -550
      }
    }
  }
tests:
- Microsoft Defender Advanced Threat Protection - Test
fromversion: 6.2.0
