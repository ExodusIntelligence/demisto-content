import json

from InvestigationDetailedSummaryParse import parse_command
from pathlib import Path

TEST_DATA_DIR = Path(__file__).parent / 'test_data'


def _dump_test_file(file_name: str, content: dict | list):
    (TEST_DATA_DIR / file_name).write_text(json.dumps(content))


def _load_test_file(file_name: str):
    return json.loads((TEST_DATA_DIR / file_name).read_text())


def test_empty_context():
    assert [_.to_context() for _ in parse_command({})] == _load_test_file('empty_context.json')


def test_parse_command():
    context = {'AttackPattern': [
        {'KillChainPhases': ['Lateral Movement', 'dummy'], 'MITREID': 'T1210',
         'Value': 'Exploitation of Remote Services'},
        {'KillChainPhases': ['Execution'], 'MITREID': 'T1059', 'Value': 'Command and Scripting Interpreter'},
        {'KillChainPhases': ['dummy'], 'MITREID': 'T0000', 'Value': 'dummy value'},
    ]}
    assert [_.to_context() for _ in parse_command(context)] == _load_test_file('parse_command.json')
