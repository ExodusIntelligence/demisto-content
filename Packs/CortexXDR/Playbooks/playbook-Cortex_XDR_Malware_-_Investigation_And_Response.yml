contentitemexportablefields:
  contentitemfields:
    propagationLabels:
    - all
id: Cortex XDR Malware - Investigation And Response
inputs:
- description: |-
    Indicates if the deduplication playbook will be used.
        True/False
  key: EnableDeduplication
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: |-
    Indicates if endpoint isolation is allowed.
    True/False
  key: AutoIsolation
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: |-
    Indicates if file retrieval from the endpoint is allowed.
    True/False
  key: RetrieveFile
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: The name of the ticketing system to use, for example, Jira or ServiceNow
  key: TicketingSystemToUse
  playbookInputQuery:
  required: false
  value: {}
- description: For ticketing systems such as Jira, a project name is required.
  key: TicketProjectName
  playbookInputQuery:
  required: false
  value: {}
- description: The tag to assign for indicators to block.
  key: MaliciousTagName
  playbookInputQuery:
  required: false
  value:
    simple: MaliciousTagName
- description: |-
    Indicates if the use of closure steps is allowed or incident will close automatically.
        True/False
  key: EnableClosureSteps
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: Comma-separated list of incident text fields to take into account when computing similarity. For example commandline, URL
  key: DedupSimilarTextField
  playbookInputQuery:
  required: false
  value:
    simple: agnetsid,users,agentsid,CMDline,Hostnames,filenames,filepaths
- description: |-
    Indicates if automatic un-isolation is allowed
        True/False
  key: AutoUnisolation
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: |-
    The maximum number of incidents to query and set to context data.
    Default is: 200
  key: DedupLimit
  playbookInputQuery:
  required: false
  value:
    simple: '200'
- description: "This input defines how to handle Similar incidents. \nYou may choose between: \"Link\", \"Close\", \"Link and Close\".\nNote: that closing incidents will require you to define \"CloseSimilar\" input as well.\nAlso, note that the closer will apply on at least one of the options (indicators or fields) which will match the \"closer percentage\" criteria.\nDefault: Link "
  key: DedupHandleSimilar
  playbookInputQuery:
  required: false
  value:
    simple: Link
- description: |-
    Define if you would like to close incidents by a similarity percentage. The percentage will be the bottom border for closing inc.
    This option will close also exact matches as well ( if there are).
    Value should be between 0 to 1 [0=low similarity , 1=identical]
  key: DedupCloseSimilar
  playbookInputQuery:
  required: false
  value:
    simple: '0.9'
- description: |-
    Retain incidents with a similarity score that's higher than the MinimunIncidentSimilarity.
    Default: 0.2
    Value should be between 0 to 1 [0=low similarity, 1=identical]
  key: DedupMinimunIncidentSimilarity
  playbookInputQuery:
  required: false
  value:
    simple: '0.2'
- description: The name of the tag to apply for allowed indicators.
  key: BenignTagName
  playbookInputQuery:
  required: false
  value:
    simple: BenignTagName
- description: |-
    Choose if you want to run Advance Hunting queries through your Cortex XDR Instance by using the information on Alert Insights. Note that it may take some time.
    Possible values: True / False
  key: AdvancedHunting
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: Choose True / False on running the Advanced Hunting section for all Mitre Tactics.
  key: RunAllHuntMitreTactics
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
name: Cortex XDR Malware - Investigation And Response
outputs:
- contextPath: PaloAltoNetworksXDR.ScriptResult.results
  type: unknown
  description: Palo ALto Networks Script reuslts information.
starttaskid: '0'
tasks:
  '0':
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '96'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 8e965db4-7e04-4776-87ab-2d69f79afca1
      iscommand: false
      name: ''
      version: -1
      description: ''
    taskid: 8e965db4-7e04-4776-87ab-2d69f79afca1
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 460,
          "y": -110
        }
      }
  '6':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.EnableDeduplication
          operator: isEqualString
          right:
            value:
              simple: Yes
      label: yes
    id: '6'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '8'
      yes:
      - '98'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: b830bf6a-5687-44fc-8873-f1dc26fd0358
      iscommand: false
      name: Use deduplication?
      description: Use deduplication?
      type: condition
      version: -1
    taskid: b830bf6a-5687-44fc-8873-f1dc26fd0358
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 315
        }
      }
  '8':
    id: '8'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '86'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 40f77524-5a25-4adb-8e63-29fc45f98fe3
      iscommand: false
      name: Deduplication Done
      type: title
      version: -1
      description: ''
    taskid: 40f77524-5a25-4adb-8e63-29fc45f98fe3
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 670
        }
      }
  '26':
    id: '26'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '103'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: d22dce22-f1e2-48a6-8187-e7703db9a68d
      iscommand: false
      name: Sandbox
      type: title
      version: -1
      description: ''
    taskid: d22dce22-f1e2-48a6-8187-e7703db9a68d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 980
        }
      }
  '27':
    id: '27'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '31'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 5a087c42-ff9d-4904-8aa2-fa1a77952943
      iscommand: false
      name: Any prevention actions?
      type: title
      version: -1
      description: ''
    taskid: 5a087c42-ff9d-4904-8aa2-fa1a77952943
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 860,
          "y": 980
        }
      }
  '31':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.action_pretty
          operator: containsString
          right:
            value:
              simple: block
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.action_pretty
          operator: containsString
          right:
            value:
              simple: prevent
      label: Prevention
    id: '31'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      Prevention:
      - '32'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: b7ae3a9a-400d-491f-8380-dd053fd9815c
      iscommand: false
      name: Check if there were any prevention Actions?
      description: Check if there were any prevention Actions?
      type: condition
      version: -1
    taskid: b7ae3a9a-400d-491f-8380-dd053fd9815c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1100
        }
      }
  '32':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: alerts.action_pretty
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_sha256
                    operator: in
                    right:
                      iscontext: true
                      value:
                        simple: File(val.Malicious).SHA256
                  - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_wildfire_verdict
                    operator: isEqualString
                    right:
                      value:
                        simple: Malicious
                root: PaloAltoNetworksXDR.Incident
          operator: containsString
          right:
            value:
              simple: Block
        - left:
            iscontext: true
            value:
              complex:
                accessor: alerts.action_pretty
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_sha256
                    operator: in
                    right:
                      iscontext: true
                      value:
                        simple: File(val.Malicious).SHA256
                  - left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_wildfire_verdict
                    operator: isEqualString
                    right:
                      value:
                        simple: Malicious
                root: PaloAltoNetworksXDR.Incident
          operator: isEqualString
          right:
            value:
              simple: Prevent
      label: yes
    id: '32'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '80'
      yes:
      - '33'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: f1723fad-4986-47e1-85a3-0515cc990f82
      iscommand: false
      name: Was the malicious hash Blocked?
      description: Was the malicious hash Blocked?
      type: condition
      version: -1
    taskid: f1723fad-4986-47e1-85a3-0515cc990f82
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1480
        }
      }
  '33':
    id: '33'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '54'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 01af48b3-440b-42b5-8a48-69f9d535ffde
      iscommand: false
      name: Manual Review if needed to proceed with the investigation
      type: title
      version: -1
      description: ''
    taskid: 01af48b3-440b-42b5-8a48-69f9d535ffde
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1825
        }
      }
  '36':
    fieldMapping:
    - incidentfield: Malware Investigation Summary
      output:
        simple: ${InvestigationSummary}
    id: '36'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '54'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves information from previously run reputation commands and aggregates their results.
      id: e41f83e0-5044-4346-868b-300c547462c8
      iscommand: false
      name: Parse Finding from the sandboxes
      scriptName: InvestigationSummaryParse
      type: regular
      version: -1
    taskid: e41f83e0-5044-4346-868b-300c547462c8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 2570
        }
      }
  '37':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.RetrieveFile
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: yes
    id: '37'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '40'
      yes:
      - '111'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: c9fd0b7c-27f9-4b2d-884e-06d1ebf61202
      iscommand: false
      name: Is file retrieval allowed?
      description: Is file retrieval allowed?
      type: condition
      version: -1
    taskid: c9fd0b7c-27f9-4b2d-884e-06d1ebf61202
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1550
        }
      }
  '38':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: NonFoundHashes
          operator: isNotEmpty
      label: yes
    id: '38'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '41'
      yes:
      - '42'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 9cf9d4bf-c36f-4f33-8110-df7db8f54e7e
      iscommand: false
      name: Were there any hashes without a verdict?
      description: Were there any hashes without a verdict?
      type: condition
      version: -1
    taskid: 9cf9d4bf-c36f-4f33-8110-df7db8f54e7e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 1250
        }
      }
  '40':
    id: '40'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '36'
      - '116'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: a7647bb0-3a11-41b4-8882-0e6dc1aad53d
      iscommand: false
      name: Parse Findings
      type: title
      version: -1
      description: ''
    taskid: a7647bb0-3a11-41b4-8882-0e6dc1aad53d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 2420
        }
      }
  '41':
    id: '41'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '40'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 00e13033-ad60-4ac7-8116-d2f2ca19d814
      iscommand: false
      name: Known File
      type: title
      version: -1
      description: ''
    taskid: 00e13033-ad60-4ac7-8116-d2f2ca19d814
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 1430
        }
      }
  '42':
    id: '42'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '37'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: e84ee9d6-01da-4cad-861d-9b55f7dbecb5
      iscommand: false
      name: Unknown File
      type: title
      version: -1
      description: ''
    taskid: e84ee9d6-01da-4cad-861d-9b55f7dbecb5
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1430
        }
      }
  '45':
    id: '45'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 0
      scriptArguments:
        File:
          complex:
            filters:
            - - ignorecase: true
                left:
                  iscontext: true
                  value:
                    simple: File.Extension
                operator: notContainsString
                right:
                  value:
                    simple: gz
            - - ignorecase: true
                left:
                  iscontext: true
                  value:
                    simple: File.Name
                operator: notContainsString
                right:
                  value:
                    simple: Investigation_package_incident
            root: File
      wait: 1
    nexttasks:
      '#none#':
      - '40'
    note: false
    quietmode: 0
    scriptarguments:
      File:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: File.Name
              operator: notContainsString
              right:
                value:
                  simple: wildfire_report
          root: File
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      id: c5ce5d86-2f81-48dd-84bc-12d3cc73a7bd
      iscommand: false
      name: 470ceb33-1487-47a0-8337-a6c50149f385
      playbookId: 470ceb33-1487-47a0-8337-a6c50149f385
      type: playbook
      version: -1
      description: ''
    taskid: c5ce5d86-2f81-48dd-84bc-12d3cc73a7bd
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 2250
        }
      }
  '47':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.DetonateFile
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: yes
    id: '47'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '40'
      yes:
      - '45'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 30e9fab6-2dd4-4c01-805b-deafcee56e08
      iscommand: false
      name: Is Detonate Allowed?
      description: Is Detonate Allowed?
      type: condition
      version: -1
    taskid: 30e9fab6-2dd4-4c01-805b-deafcee56e08
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 2060
        }
      }
  '54':
    id: '54'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '97'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: e7d04473-3410-4597-81bb-31979a9b79d1
      iscommand: false
      name: Conclusion
      type: title
      version: -1
      description: ''
    taskid: e7d04473-3410-4597-81bb-31979a9b79d1
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2780
        }
      }
  '60':
    id: '60'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 5ff7928a-497b-4183-8127-3002151bce2d
      iscommand: false
      name: Done
      type: title
      version: -1
      description: ''
    taskid: 5ff7928a-497b-4183-8127-3002151bce2d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3640
        }
      }
  '62':
    form:
      description: ''
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '0'
        label: ''
        labelarg:
          simple: 'Incident Classification '
        options: []
        optionsarg:
        - simple: Manual
        - simple: True Positive
        - simple: False Positive
        placeholder: ''
        readonly: false
        required: true
        tooltip: ''
        type: singleSelect
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '1'
        label: ''
        labelarg:
          simple: Comment
        options: []
        optionsarg: []
        placeholder: ''
        readonly: false
        required: true
        tooltip: Please enter information
        type: shortText
      sender: ''
      title: Incident Classification
      totalanswers: 0
    id: '62'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
      cc:
        simple: Administrator,Analyst
      format: ''
      methods: []
      replyOptions:
      - True Positive
      - False Positive
      subject:
        simple: Is this incident FP
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to:
        simple: Administrator,Analyst
    nexttasks:
      '#none#':
      - '104'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 218579e0-9446-4663-8376-0178c65c0b2e
      iscommand: false
      name: False / True Positive
      description: False / True Positive
      type: collection
      version: -1
    taskid: 218579e0-9446-4663-8376-0178c65c0b2e
    timertriggers: []
    type: collection
    view: |-
      {
        "position": {
          "x": -190,
          "y": 3110
        }
      }
  '78':
    id: '78'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '6'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Set multiple keys/values to the context.
      id: 9b84a43d-0782-40d0-8e70-fd313c2be150
      iscommand: false
      name: Dedup
      type: title
      version: -1
    taskid: 9b84a43d-0782-40d0-8e70-fd313c2be150
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 190
        }
      }
  '80':
    id: '80'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '54'
    note: false
    quietmode: 0
    scriptarguments:
      appendTags:
        simple: 'true'
      severity:
        simple: High
      tags:
        simple: Containment Occured
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: adfb6138-4ca3-481d-8ce6-eab0962b705d
      iscommand: true
      name: Raise the incident severity
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: adfb6138-4ca3-481d-8ce6-eab0962b705d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1810
        }
      }
  '86':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Endpoint.Status
          operator: isNotEqualString
          right:
            value:
              simple: Isolated
      label: yes
    id: '86'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      yes:
      - '26'
      - '27'
      - '91'
      - '112'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: f0caf790-7b18-4b84-8af8-988f7f5985d4
      iscommand: false
      name: Check if the device is not isolated?
      description: Check if the device is not isolated?
      type: condition
      version: -1
    taskid: f0caf790-7b18-4b84-8af8-988f7f5985d4
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 810
        }
      }
  '91':
    id: '91'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '95'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 2525979c-591b-4668-8f2f-269615446935
      iscommand: false
      name: Command Line Analysis
      type: title
      version: -1
      description: ''
    taskid: 2525979c-591b-4668-8f2f-269615446935
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -20,
          "y": 980
        }
      }
  '92':
    id: '92'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      scriptArguments:
        Commandline:
          complex:
            accessor: cmdline
            root: incident
            transformers:
            - operator: uniq
      wait: 1
    nexttasks:
      '#none#':
      - '93'
    note: false
    quietmode: 0
    scriptarguments:
      Commandline:
        complex:
          accessor: cmdline
          root: incident
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: incident.parentcmdline
            operator: append
          - args:
              item:
                iscontext: true
                value:
                  simple: incident.processcmd
            operator: append
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: "This playbook takes the command line from the alert and performs the following actions:\n- Checks for base64 string and decodes if exists\n- Extracts and enriches indicators from the command line\n- Checks specific arguments for malicious usage \n\nAt the end of the playbook, it sets a possible verdict for the command line, based on the finding:\n1. Indicators found in the command line\n2. Found AMSI techniques\n3. Found suspicious parameters\n4. Usage of malicious tools\n5. Indication of network activity"
      id: bce85868-231c-4f5c-8115-5220bc041810
      iscommand: false
      name: Command-Line Analysis
      playbookId: Command-Line Analysis
      type: playbook
      version: -1
    taskid: bce85868-231c-4f5c-8115-5220bc041810
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1290
        }
      }
  '93':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: CommandlineVerdict
          operator: isNotEmpty
      label: yes
    id: '93'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      yes:
      - '94'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 1c92ee9f-7bf5-4169-8ebe-2f82aa07c830
      iscommand: false
      name: Found any suspicious components?
      description: Found any suspicious components?
      type: condition
      version: -1
    taskid: 1c92ee9f-7bf5-4169-8ebe-2f82aa07c830
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1445
        }
      }
  '94':
    id: '94'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '33'
    note: false
    quietmode: 0
    scriptarguments:
      appendTags:
        simple: 'true'
      tags:
        complex:
          root: CommandlineVerdict
          transformers:
          - operator: Stringify
          - args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: '"(\w*)":'
              unpack_matches: {}
            operator: RegexExtractAll
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: c78931f4-447f-41cd-8756-7b8f0ed7c8b5
      iscommand: true
      name: Set Tag `Suspicious Command-line`
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: c78931f4-447f-41cd-8756-7b8f0ed7c8b5
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1635
        }
      }
  '95':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: cmdline
                root: incident
                transformers:
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: incident.parentcmdline
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: incident.processcmd
                  operator: append
          operator: isNotEmpty
          right:
            value: {}
      label: yes
    id: '95'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      yes:
      - '92'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: ad667008-2b29-45c5-8a6d-5a127e9d95ec
      iscommand: false
      name: Is there a CMD line parameter?
      description: Is there a CMD line parameter?
      type: condition
      version: -1
    taskid: ad667008-2b29-45c5-8a6d-5a127e9d95ec
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1130
        }
      }
  '96':
    id: '96'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '78'
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      id: 6533bffb-03d6-4d4f-8ead-5cc895f1ba8a
      iscommand: false
      name: Cortex XDR Malware - Incident Enrichment
      playbookId: Cortex XDR Malware - Incident Enrichment
      type: playbook
      version: -1
      description: ''
    taskid: 6533bffb-03d6-4d4f-8ead-5cc895f1ba8a
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 20
        }
      }
  '97':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.EnableClosureSteps
          operator: isEqualString
          right:
            value:
              simple: 'True'
      label: yes
    id: '97'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '60'
      yes:
      - '62'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 8a7da9ff-6a11-4da7-81b0-e1a6c003d52e
      iscommand: false
      name: Proceed To Closure Steps?
      description: Proceed To Closure Steps?
      type: condition
      version: -1
    taskid: 8a7da9ff-6a11-4da7-81b0-e1a6c003d52e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2940
        }
      }
  '98':
    id: '98'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - '8'
    note: false
    quietmode: 0
    scriptarguments:
      CloseSimilar:
        simple: ${inputs.DedupCloseSimilar}
      closeReason:
        simple: Closed by Dedup Playbook within inc ${incident.id}
      fromDate:
        simple: 1 months ago
      handleSimilar:
        simple: ${inputs.DedupHandleSimilar}
      limit:
        simple: ${inputs.DedupLimit}
      method:
        simple: Fields and Indicators
      minimunIncidentSimilarity:
        simple: ${inputs.DedupMinimunIncidentSimilarity}
      query:
        simple: -status:closed -category:job
      showIncidentSimilarityForAllFields:
        simple: 'True'
      similarTextField:
        simple: ${inputs.DedupSimilarTextField}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: "This playbook identifies duplicate incidents using the XSOAR machine learning method (script).\nIn this playbook, you can choose how to find similar incidents by using fields and/or indicators to be compared against other incidents in the XSOAR DB.\n\nRemember that the identification of similar incidents is *must* be defined properly in the playbook's inputs. "
      id: 3db4422c-bccd-40ae-8a22-905ad527ed53
      iscommand: false
      name: Dedup - Generic v4
      playbookId: Dedup - Generic v4
      type: playbook
      version: -1
    taskid: 3db4422c-bccd-40ae-8a22-905ad527ed53
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 740,
          "y": 490
        }
      }
  '103':
    id: '103'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '38'
    note: false
    quietmode: 0
    scriptarguments:
      FileSha256:
        simple: ${incident.filesha256}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      id: fffa9987-4fa4-4be9-8165-90dbd06db592
      iscommand: false
      name: 5d24f937-9988-4647-8247-7415e343b581
      playbookId: 5d24f937-9988-4647-8247-7415e343b581
      type: playbook
      version: -1
      description: ''
    taskid: fffa9987-4fa4-4be9-8165-90dbd06db592
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 1090
        }
      }
  '104':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Incident Classification.Questions.0
          operator: containsString
          right:
            value:
              simple: 'False'
      label: False Positive
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Incident Classification.Questions.0
          operator: containsString
          right:
            value:
              simple: ture
      label: True Positive
    id: '104'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '105'
      False Positive:
      - '107'
      True Positive:
      - '106'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: dd11522b-92aa-4412-8c70-f85d93b5924a
      iscommand: false
      name: Check Classification
      description: Check Classification
      type: condition
      version: -1
    taskid: dd11522b-92aa-4412-8c70-f85d93b5924a
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -190,
          "y": 3270
        }
      }
  '105':
    id: '105'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '60'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 839dfe7c-bc7e-42ac-8741-e4ab1c4c2c69
      iscommand: false
      name: Manual Handing
      description: Manual Handing of this incident per your procedures.
      type: regular
      version: -1
    taskid: 839dfe7c-bc7e-42ac-8741-e4ab1c4c2c69
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -190,
          "y": 3460
        }
      }
  '106':
    id: '106'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '60'
    note: false
    quietmode: 0
    scriptarguments:
      AutoIsolation:
        simple: ${inputs.AutoIsolation}
      BlockTag:
        simple: ${inputs.MaliciousTagName}
      Classification:
        simple: ${Incident Classification.Answers.0}
      Comment:
        simple: ${Incident Classification.Answers.1}
      TicketProjectName:
        simple: ${inputs.TicketProjectName}
      TicketingSystemToUse:
        simple: ${inputs.TicketingSystemToUse}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      id: 8653e29c-9b63-4179-849c-6503491eac16
      iscommand: false
      name: Cortex XDR - True Positive Incident Handling
      playbookId: Cortex XDR - True Positive Incident Handling
      type: playbook
      version: -1
      description: ''
    taskid: 8653e29c-9b63-4179-849c-6503491eac16
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -590,
          "y": 3460
        }
      }
  '107':
    id: '107'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '60'
    note: false
    quietmode: 0
    scriptarguments:
      AllowTag:
        simple: ${inputs.BenignTagName}
      AutoUnisolation:
        simple: ${inputs.AutoUnisolation}
      Comment:
        simple: 'XSOAR Incident #${incident.id}'
      FileSha256:
        simple: ${incident.filesha256}
      HostID:
        simple: ${incident.deviceid}
      Reason:
        simple: ${Incident Classification.Answers.0}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      id: f61028d3-131e-43e3-8234-7002ee0673e2
      iscommand: false
      name: Cortex XDR - False Positive Incident Handling
      playbookId: Cortex XDR - False Positive Incident Handling
      type: playbook
      version: -1
      description: ''
    taskid: f61028d3-131e-43e3-8234-7002ee0673e2
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 220,
          "y": 3460
        }
      }
  '110':
    id: '110'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '47'
    note: false
    quietmode: 0
    scriptarguments:
      action_id:
        simple: ${PaloAltoNetworksXDR.RetrievedFiles.action_id}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: View the file retrieved by the xdr-retrieve-files command according to the action ID. Before running this command, you can use the xdr-action-status-get command to check if this action completed successfully.
      id: c4082fd7-b7cd-4f85-843d-85c27f9dfb5b
      iscommand: true
      name: Cortex XDR - Retrieve File From Script Execution.
      script: '|||xdr-retrieve-file-details'
      type: regular
      version: -1
    taskid: c4082fd7-b7cd-4f85-843d-85c27f9dfb5b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1890
        }
      }
  '111':
    id: '111'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '110'
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_ids:
        simple: ${Endpoint.ID}
      generic_file_path:
        complex:
          accessor: actor_process_image_path
          filters:
          - - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Incident.alerts.actor_process_image_sha256
              operator: notIn
              right:
                iscontext: true
                value:
                  simple: NonFoundHashes
          root: PaloAltoNetworksXDR.Incident.alerts
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves files from selected endpoints. You can retrieve up to 20 files, from no more than 10 endpoints. At least one endpoint ID and one file path are necessary in order to run the command. After running this command, you can use the xdr-action-status-get command with returned action_id, to check the action status.
      id: 185993d8-fd8c-4833-8878-87b9bce3c1d2
      iscommand: true
      name: Cortex XDR - Retrieve File
      script: '|||xdr-file-retrieve'
      type: regular
      version: -1
    taskid: 185993d8-fd8c-4833-8878-87b9bce3c1d2
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1730
        }
      }
  '112':
    id: '112'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '115'
      - '117'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: c83e49ab-9146-4b4a-8bed-8dde0eb57fe6
      iscommand: false
      name: Advanced Hunting
      type: title
      version: -1
      description: ''
    taskid: c83e49ab-9146-4b4a-8bed-8dde0eb57fe6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -680,
          "y": 980
        }
      }
  '113':
    id: '113'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '33'
    note: false
    quietmode: 0
    scriptarguments:
      FileSHA256:
        complex:
          accessor: filesha256
          root: incident
          transformers:
          - operator: uniq
      HuntCnCTechniques:
        simple: 'True'
      HuntCollectionTechniques:
        simple: 'True'
      HuntDefenseEvasionTechniques:
        simple: 'True'
      HuntDiscoveryTechniques:
        simple: 'True'
      HuntExecutionTechniques:
        simple: 'True'
      HuntImpactTechniques:
        simple: 'True'
      HuntInitialAccessTechniques:
        simple: 'True'
      HuntLateralMovementTechniques:
        simple: 'True'
      HuntPersistenceTechniques:
        simple: 'True'
      HuntPrivilegeEscalationTechniques:
        simple: 'True'
      HuntReconnaissanceTechniques:
        simple: 'True'
      RunAll:
        simple: ${inputs.RunAllHuntMitreTactics}
      agentID:
        complex:
          accessor: agentsid
          root: incident
          transformers:
          - operator: uniq
      timeRange:
        simple: 2 hours ago
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: "This playbook handles all the endpoint investigation actions available with Cortex XSIAM, including the following tasks:\n* Pre-defined MITRE Tactics\n* Host fields (Host ID)\n* Attacker fields (Attacker IP, External host)\n* MITRE techniques\n* File hash (currently, the playbook supports only SHA256)  \n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      id: fa53539b-9a49-489d-8e69-24ed9393dd32
      iscommand: false
      name: Cortex XDR - Endpoint Investigation
      playbookId: Cortex XDR - Endpoint Investigation
      type: playbook
      version: -1
    taskid: fa53539b-9a49-489d-8e69-24ed9393dd32
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -1140,
          "y": 1310
        }
      }
  '115':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.AdvancedHunting
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: yes
    id: '115'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      yes:
      - '113'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Should run Advanced Hunting?
      id: 038c1c41-d13b-48fb-88db-545d5cdc7478
      iscommand: false
      name: Should run Advanced Hunting?
      type: condition
      version: -1
    taskid: 038c1c41-d13b-48fb-88db-545d5cdc7478
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -890,
          "y": 1130
        }
      }
  '116':
    fieldMapping:
    - incidentfield: Malware Detailed Investigation Summary
      output:
        simple: ${InvestigationDetailedSummary}
    id: '116'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '54'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Parses attacks from context, and shows them according to the MITRE technique they use
      id: c639583a-5795-4594-8db6-d640fb36bcbe
      iscommand: false
      name: Parse Findings From the Sandbox
      scriptName: InvestigationDetailedSummaryParse
      type: regular
      version: -1
    taskid: c639583a-5795-4594-8db6-d640fb36bcbe
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1400,
          "y": 2570
        }
      }
  '117':
    id: '117'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - '33'
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_ids:
        simple: ${incident.deviceid}
      polling_timeout:
        simple: '10'
      script_uid:
        simple: 956e8989f67ebcb2c71c4635311e47e4
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: Initiates a new endpoint script execution action using a provided script unique id from Cortex XDR script library.
      id: 9f214606-ee30-4b9f-815e-a0f7a19c95bc
      iscommand: false
      name: Cortex XDR - Run script
      playbookId: Cortex XDR - Run script
      type: playbook
      version: -1
    taskid: 9f214606-ee30-4b9f-815e-a0f7a19c95bc
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -460,
          "y": 1130
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "31_33_#default#": 0.1,
      "32_33_yes": 0.68,
      "6_8_#default#": 0.5,
      "86_33_#default#": 0.11
    },
    "paper": {
      "dimensions": {
        "height": 3815,
        "width": 3330,
        "x": -1140,
        "y": -110
      }
    }
  }
tests:
- No tests (auto formatted)
fromversion: 6.2.0
description: 'This playbook investigates Cortex XDR malware incidents. In this playbook, we are using: - Cortex XDR insights - Command Line Analysis - Dedup - Sandbox hash search and detonation - Cortex XDR enrichment - Incident Handling ( True/False Positive)'
